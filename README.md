# ClipsAI

<!-- [![PyPI version](https://badge.fury.io/py/project-name.svg)](https://badge.fury.io/py/project-name) -->
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)


## Quickstart

Clips AI is an open-source Python library that automatically converts long videos into
clips. With just a few lines of code, you can segment a video into multiple clips and
resize its aspect ratio from 16:9 to 9:16.

> **Note:** Clips AI is designed for audio-centric, narrative-based videos such as
podcasts, interviews, speeches, and sermons. It now leverages **Google Cloud AI services (Video Intelligence, Speech-to-Text, Natural Language, Vision)** for its core processing tasks like transcription, diarization, scene detection, and content analysis. Our resizing algorithm dynamically reframes and focuses on
the current speaker, converting the video into various aspect ratios.

For full documentation, visit [Clips AI Documentation](https://clipsai.com).
Check out a [UI demo](https://demo.clipsai.com) with clips generated by this library.

### Installation

1.  Install Python dependencies. <br></br> *We highly suggest using a virtual environment (such as [venv](https://packaging.python.org/en/latest/guides/installing-using-pip-and-virtual-environments/#create-and-use-virtual-environments)) to avoid dependency conflicts*
    ```bash
    pip install clipsai
    ```

    Install Google Cloud libraries:
    ```bash
    pip install google-cloud-speech google-cloud-videointelligence google-cloud-vision google-cloud-language google-cloud-video-transcoder google-cloud-storage
    ```

2.  Install [libmagic](https://github.com/ahupp/python-magic?tab=readme-ov-file#debianubuntu)

3.  Install [ffmpeg](https://github.com/kkroening/ffmpeg-python/tree/master?tab=readme-ov-file#installing-ffmpeg)

### Google Cloud Setup

To use ClipsAI with Google Cloud services, you need to set up a Google Cloud Platform (GCP) project and authenticate.

1.  **Create or Select a GCP Project**: Ensure you have a GCP project and billing is enabled.
2.  **Enable APIs**: Enable the following APIs for your project:
    *   Cloud Speech-to-Text API
    *   Cloud Video Intelligence API
    *   Cloud Vision API
    *   Cloud Natural Language API
    *   Cloud Transcoder API (if using the refactored `MediaEditor.transcode` method)
    *   Cloud Storage API (required for temporary file storage)
3.  **Authentication**: The library uses Application Default Credentials (ADC). Set up authentication by:
    *   Creating a service account with appropriate roles (e.g., Video Intelligence User, Speech-to-Text User, Cloud Storage Admin/ObjectAdmin for the temp bucket).
    *   Downloading the JSON key file for the service account.
    *   Setting the `GOOGLE_APPLICATION_CREDENTIALS` environment variable to the path of this JSON key file.
      ```bash
      export GOOGLE_APPLICATION_CREDENTIALS="/path/to/your/keyfile.json"
      ```
4.  **Configuration via Environment Variables**: ClipsAI uses the following environment variables for Google Cloud configuration:
    *   `GOOGLE_CLOUD_PROJECT`: Your GCP Project ID.
    *   `GOOGLE_CLOUD_LOCATION`: Your GCP region (e.g., `us-central1`). Required for some services like the Transcoder API.
    *   `GOOGLE_CLOUD_TEMP_GCS_BUCKET_NAME`: The name of a GCS bucket that ClipsAI can use for temporary storage (e.g., uploading local files for API processing). Ensure the service account has read/write access to this bucket.

### Creating clips

Since clips are found using the video's transcript, the video must first be transcribed. Transcribing is now done using **Google Cloud Speech-to-Text API** which also provides speaker diarization information. For trimming the original video into a chosen clip, refer to the clipping reference (Note: `MediaEditor.trim` still uses ffmpeg locally, while `MediaEditor.transcode` has been refactored to use Google Cloud Transcoder API).

```python
from clipsai import ClipFinder, Transcriber
from clipsai.gcloud.config import GCloudConfig # New import

# Initialize Google Cloud configuration (reads from environment variables if not passed)
gcloud_config = GCloudConfig()

# Transcriber now requires gcloud_config
# Default language for Transcriber is "en-US"
transcriber = Transcriber(gcloud_config=gcloud_config)
# The transcribe method can take an iso6391_lang_code parameter if needed.
transcription = transcriber.transcribe(audio_file_path="/abs/path/to/video.mp4")

# ClipFinder now requires gcloud_config and has different parameters
# Default min/max duration are 15/900. nlp_text_chunk_size_words default is 150.
clipfinder = ClipFinder(gcloud_config=gcloud_config)
clips = clipfinder.find_clips(transcription=transcription)

if clips:
    print("StartTime: ", clips[0].start_time)
    print("EndTime: ", clips[0].end_time)
else:
    print("No clips found.")
```

Use `GoogleClipFinder` for clip suggestions from Google's APIs. The
`clip_length` parameter accepts `30`, `60`, `90`, or `'auto'`. When set
to `'auto'` the finder picks one of 30, 60, or 90 seconds based on the
video's duration or API-provided scores.
(Note: `GoogleClipFinder` may need updates to align with GCloudConfig and API changes if it hasn't been refactored yet. This example assumes it works as previously.)

```python
from clipsai import GoogleClipFinder
from clipsai.gcloud.config import GCloudConfig # Assuming GoogleClipFinder also uses GCloudConfig

gcloud_config = GCloudConfig()
# Ensure GoogleClipFinder is initialized appropriately if its constructor changed.
# For this example, assuming it might take gcloud_config.
gfinder = GoogleClipFinder(gcloud_config=gcloud_config, clip_length="auto")
clips = gfinder.find_clips(
    video_file_path="/abs/path/to/video.mp4",
    video_length=transcription.end_time, # Ensure transcription object is available
)
```

### Resizing a video

Speaker diarization is now performed as part of the transcription process using Google Cloud Speech-to-Text API. Scene detection uses Google Cloud Video Intelligence API. Face detection for intelligent cropping now uses Google Cloud Vision API.

```python
from clipsai import resize
from clipsai.gcloud.config import GCloudConfig # New import

# Initialize Google Cloud configuration
gcloud_config = GCloudConfig()

crops = resize(
    video_file_path="/abs/path/to/video.mp4",
    gcloud_config=gcloud_config, # New parameter
    # pyannote_auth_token is removed
    # transcriber_default_language_code can be added if not using default "en-US"
    aspect_ratio=(9, 16)
)

print("Crops: ", crops.segments)
```
